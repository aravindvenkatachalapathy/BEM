% ---------------------------------------------------------------------
% History
% ---------------------------------------------------------------------
% v1.12 DS on 07-Oct-2023: align with WETI v1.13: add booktabs, tabu, subtitle feature, \CiteText
% v1.11 SR on 02-Dec-2021: removed all FUA comments, added sowento colors, adjusted template
% v1.10 FL on 25-Nov-2021: add example input definitions; Add tikz packages shadows, backgrounds; Add tikz animations (visible on)
% v1.9  DS on 30-May-2021: add sowento (Changes see @sowento) 
% v1.8  DS on 30-May-2021: add warning related stuff
% v1.7  DS on 24-Apr-2021: add animate
% v1.6  DS on 11-Apr-2021: update footline, remove doi
% v1.5  DS on 26-Mar-2021: change from bibtex to biblatex with biber
% v1.4  DS on 16-Mar-2021: add cancel and Tikz Details
% v1.3  DS on 09-Mar-2021: add doi and SWE logo
% v1.2  DS on 22-Aug-2020: Smaller adjustments for Advanced Engineering Lecture
% v1.1  DS on 22-Sep-2018: Disclaimer Adjustments, background folder
% v1.0  DS on 09-Oct-2018
% ---------------------------------------------------------------------
% Header example
% ---------------------------------------------------------------------
%\title[\#5: Tower Damper]{Tower Damper}
%\institute[WETI \& SWE]{Wind Energy Technology Institute \& Stuttgart Wind Energy}
%\author[David Schlipf]{Prof. Dr.-Ing. David Schlipf}
%\date{01.11.2021\\Lecture \#5 of Course\\``Controller Design for Wind Turbines and Wind Farms''}
%\def\homepage{bla.de}
%\def\emailaddress{bla@bla.de}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%\def\StylePath{sowento-style/}
%% \usepackage[corePath=\StylePath/core/, TitleBackgroundPicture=\StylePath/core/background-waves]{sowento-style/sowento-Presentation}
%\bibliography{\StylePath/sowentoReferences}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ---------------------------------------------------------------------
% Options
% ---------------------------------------------------------------------
% to use options in key-value format for their package options
\RequirePackage{kvoptions} 
\SetupKeyvalOptions{
	family = WFS,
	prefix = WFS@
}
\DeclareStringOption[./core/]{corePath}
\DeclareStringOption[sowento-style/core/background_CART3]{TitleBackgroundPicture}
\ExecuteOptions{%
	blackLinks=true,
	compactLayout=false,
	draft=false,
	logo=true,
	corePath=./core/,
	deliverable=false}
\ProcessKeyvalOptions{WFS}
% ---------------------------------------------------------------------
% Input
% ---------------------------------------------------------------------
\input{\WFS@corePath/putAtDefines}
% ---------------------------------------------------------------------
% Beamer Style
% ---------------------------------------------------------------------
% Theme
\usetheme{Dresden}
\usefonttheme[onlymath]{serif}
% Colors
\definecolor{sowentoBlue}{HTML}{1b6ca3}
\definecolor{sowentoBlueLight}{HTML}{2989b2}
\definecolor{sowentoBlack}{HTML}{646464}
\definecolor{sowentoBrown}{HTML}{937870}
\definecolor{sowentoTurkis}{HTML}{66cec8}
% templates
\setbeamertemplate{blocks}[rounded][shadow=false]
\setbeamertemplate{background canvas}[vertical shading][bottom=white,top=structure.fg!0]
\setbeamertemplate{sidebar canvas left}[horizontal shading][left=white!40,right=black]
\setbeamertemplate{bibliography item}{\insertbiblabel} % Removes icon in bibliography
\setbeamertemplate{section in toc}[sections numbered]
% font
\setbeamerfont{institute}{size=\fontsize{7pt}{8pt}}
\setbeamerfont{date}{size=\fontsize{7pt}{8pt}}
% color
\setbeamercolor{author in head/foot}{parent=palette tertiary,fg=white!10, bg=sowentoBlue}
\setbeamercolor{section in head/foot}{parent=palette tertiary,fg=white, bg=sowentoBlue}
\setbeamercolor{frametitle}{fg=sowentoBlue}
\setbeamercolor{title}{fg=black}
\setbeamercolor{section in toc}{fg=sowentoBlue}
\setbeamercolor{block title}{bg=sowentoBlue!5, fg=sowentoBlue}
\setbeamercolor{block body}{bg=sowentoBlue!5}
\setbeamercolor{block title alerted}{bg=sowentoBrown!20, fg=sowentoBlue}
\setbeamercolor{block body alerted}{bg=sowentoBrown!20}
\addtobeamertemplate{block alerted begin}{%
	\setbeamercolor*{item}{fg=sowentoBrown}%
}{}
\addtobeamertemplate{block begin}{%
	\setbeamercolor*{item}{fg=sowentoBlue}%
}{}
\setbeamercolor{bibliography item}{fg=sowentoBlue}
\setbeamercolor{bibliography entry note}{fg=sowentoBlue}
\setbeamercolor{bibliography entry author}{fg=sowentoBlue}

% ---------------------------------------------------------------------
% Titel page
% ---------------------------------------------------------------------
\renewcommand{\maketitle}{
	\usebackgroundtemplate{
  		\parbox[c][\paperheight][c]{\paperwidth}{\centering\includegraphics[width=\paperwidth]{\WFS@TitleBackgroundPicture}}% https://tex.stackexchange.com/questions/26458/beamer-background-image-centered
		}
	\begin{frame}[plain]
	\titlepage{
		\PutAt<1->[5cm]{(1cm,.2cm)}{\includegraphics[width=4.5cm]{\WFS@corePath/sowento-logo}}%  	@sowento: new
	}    
	\end{frame}
	\usebackgroundtemplate{} % no Background
}
% Title etc.
\defbeamertemplate*{title page}{customized}[1][]{
\begin{textblock*}{12cm}(8.0cm,0.5cm)%  
\begin{tikzpicture}
	\node[text width=8.4cm, align=center, draw=white, fill=white, shape=circle, align=center, opacity=0.6] at (0,0) {	};
	\node[text width=7cm, align=center, line width=0] at (0,0) {% 														
		\par\vspace{0.2cm}
		{\usebeamerfont{title}		\usebeamercolor[fg]{title}	 	\inserttitle		\par\vspace{0.4cm}}
		{\usebeamerfont{institute}	\usebeamercolor[fg]{title}		\insertauthor		\par\vspace{0.2cm}}
		{\usebeamerfont{date}	 	\usebeamercolor[fg]{title} 		\insertdate 		\par\vspace{0.2cm}}
		{\usebeamerfont{date}	 	\usebeamercolor[fg]{title} 		\insertsubtitle		\par\vspace{0.2cm}}
		};
	\node[align=center] at (0,0) {
		\includegraphics[width=9cm]{\WFS@corePath/sowento-circle}
	};	
\end{tikzpicture}
\end{textblock*}
}
% ---------------------------------------------------------------------
% Final page
% ---------------------------------------------------------------------
\setbeamertemplate{final page}{%
	\miniframesoff	
\begin{frame}[plain]
	\begin{tikzpicture}[remember picture,overlay]
	\node [shading = axis,rectangle, left color=sowentoBlueLight!90, right color=sowentoBlue!30!white,shading angle=45, anchor=north, minimum width=\paperwidth, minimum height=\paperheight] (box) at (current page.north){};
		\node[align=center,opacity=.3] at (.8\paperwidth,-.3\paperheight) {
		\includegraphics[width=12cm]{\WFS@corePath/sowento-turbine}
	};	
	\end{tikzpicture}
	\color{white} 
	\vspace*{5em}\newline
		\Large{\bf Let's talk...\\}
		\includegraphics[width=4cm]{\WFS@corePath/sowento-logo}\\
		\small
		\insertauthor\\ 
		E-Mail: \emailaddress \\
		\homepage\\

\vspace{3em}
{\footnotesize  sowento GmbH\\
	Hessenlauweg 14, 70569 Stuttgart, Germany\\
	Reg. Office: Stuttgart, Germany\\
	Amtsgericht Stuttgart HRB 767045\\
	Managing Director: Steffen Raach, Frank Lemmer\\
}
\end{frame}	
}
\newcommand{\finalpage}{
\usebeamertemplate{final page}
}

% ---------------------------------------------------------------------
% new environments, setlength etc.
% ---------------------------------------------------------------------
\newenvironment<>{varblock}[2][.9\textwidth]{%
	\setlength{\textwidth}{#1}
	\begin{actionenv}#3%
		\def\insertblocktitle{#2}%
		\par%
		\usebeamertemplate{block begin}}
	{\par%
		\usebeamertemplate{block end}%
\end{actionenv}}
%http://tex.stackexchange.com/questions/87249/adjust-vertical-space-before-enumerated-list-in-beamer
\setlength{\leftmargini}{0.5cm} % Abstand item vom linken rand 0 = wie normaler text
% ---------------------------------------------------------------------
% headline, footline, frametitle
% ---------------------------------------------------------------------
\setbeamertemplate{headline}{\vspace*{.5cm}}
\setbeamertemplate{footline}{
	\vbox{
		\pgfsetfillopacity{1}
		\begin{beamercolorbox}[wd=\paperwidth,ht=0.45cm,dp=1ex]{author in head/foot}
			\usebeamerfont{author in head/foot}
			\begin{tabularx}{\textwidth}{lXp{0.8cm}<{\raggedleft\arraybackslash}}
				\begin{tabular}[t]{@{}l@{}}\insertshortauthor ~~|~~ \insertshortinstitute\\ \insertshorttitle \end{tabular} & \insertnavigation{\linewidth} & 
				\insertframenumber/\inserttotalframenumber
			\end{tabularx}	
		\end{beamercolorbox}%
	}
	\vspace*{.3cm}
}

\setbeamertemplate{frametitle}
{\leavevmode\hspace{0.5cm}{\usebeamerfont{header_font_subsection}{\bf\insertframetitle}}
}
% ---------------------------------------------------------------------
% Navigation
% ---------------------------------------------------------------------
\setbeamertemplate{navigation symbols}{}
%---------------------------------------------------------------------------------------------------------
%http://tex.stackexchange.com/questions/49241/navigation-bullets-very-small-in-custom-beamer-outer-theme
\newdimen\beamer@miniframeradius
\beamer@miniframeradius=0.05cm
\define@key{beamer@margin}{mini frame radius}{\beamer@miniframeradius=#1\relax}
\setbeamertemplate{mini frame}
{%
	\begin{pgfpicture}{0.00cm}{0.00cm}{2\beamer@miniframeradius}{2\beamer@miniframeradius}
		\includegraphics[width=0.12cm]{\WFS@corePath/MiniFrameSowento.pdf}
	\end{pgfpicture}%
}
%---------------------------------------------------------------------------------------------------------
% Remove some pages from the navigation
%http://tex.stackexchange.com/questions/37127/how-to-remove-some-pages-from-the-navigation-bullets-in-beamer	
\let\beamer@writeslidentry@miniframeson=\beamer@writeslidentry
\def\beamer@writeslidentry@miniframesoff{%
	\expandafter\beamer@ifempty\expandafter{\beamer@framestartpage}{}% does not happen normally
	{%else
		% removed \addtocontents commands
		\clearpage\beamer@notesactions%
	}
}
\newcommand*{\miniframeson}{\let\beamer@writeslidentry=\beamer@writeslidentry@miniframeson}
\newcommand*{\miniframesoff}{\let\beamer@writeslidentry=\beamer@writeslidentry@miniframesoff}
\beamer@compresstrue
%---------------------------------------------------------------------------------------------------------	
% ---------------------------------------------------------------------
% Other packages
% ---------------------------------------------------------------------
% uniformly use international system of units
\RequirePackage{siunitx}
% Tikz
\RequirePackage{tikz}
\usetikzlibrary{shapes,positioning,tikzmark,arrows,math,fit,calc,shadows.blur,backgrounds}
\RequirePackage{tikz-3dplot}
\RequirePackage{pgfplots}
%https://tex.stackexchange.com/questions/81899/what-does-running-in-backwards-compatibility-mode-mean-and-what-should-i-fix-t
\pgfplotsset{compat=newest,compat/show suggested version=false}
\tikzstyle{every picture}+=[remember picture] % https://tex.stackexchange.com/questions/56498/tikz-grid-and-remember-picture-overlay
% set border of slides
\RequirePackage{geometry}
\geometry{left=0.5cm,right=0.5cm,bottom=1cm}
% accept different input encodings
\RequirePackage[utf8]{inputenc}
% accept different output encodings
\RequirePackage[T1]{fontenc}
% enhanced support for graphics
\RequirePackage{graphicx}
% mathematical features 
\RequirePackage{mathtools}
\RequirePackage{bm}
% use latin modern font, sans serif
\RequirePackage{lmodern}
% placing boxes at absolute positions 
\RequirePackage[absolute,overlay]{textpos}
% rotate stuff
\RequirePackage{rotating}
%---------------------------------------------
%Processes the PostScript graphics with psfrag to add labels within the graphic
% includes bugfix for clash with hyperref 2021
\RequirePackage[crop=pdfcrop]{pstool}%Bugfix for clash with hyperref 2021: https://tex.stackexchange.com/questions/570404/pdflatex-fails-on-pstool-when-hyperref-is-included
%add following lines after hyperref: 
\RequirePackage{bookmark}
\makeatletter
\providecommand\HyPL@Entry[1]{}
\makeatother
%---------------------------------------------
\RequirePackage{epstopdf}
% nice tables
\RequirePackage{tabularx}
\RequirePackage{multirow}
\RequirePackage{tabu}
\RequirePackage{booktabs}
% cancel out stuff
\RequirePackage{cancel}
% animate graphics
\RequirePackage{animate}
% -------------------------------------------------------------
% Bibliography
% -------------------------------------------------------------
% Use author-date style for the bibliography
\RequirePackage[style=numeric,%
backend=biber,%
sorting=none,%
doi = true,%
url = true,%
maxbibnames = 6,%
giveninits=true,
]{biblatex}
% make sure some font is used: https://tex.stackexchange.com/questions/203111/small-caps-font-warning-in-beamer-using-biblatex
\renewcommand\mkbibacro[1]{{\bibfont\MakeUppercase{#1}}}
% ---------------------------------------------------------------------
% Tikz animations
% ---------------------------------------------------------------------
%For animations of tikz graphics:
\tikzset{
	invisible/.style={opacity=0},
	visible on/.style={alt={#1{}{invisible}}},
	alt/.code args={<#1>#2#3}{%
		\alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
	},
}
% ---------------------------------------------------------------------
% Warnings related stuff
% ---------------------------------------------------------------------
% page-group Warning: https://tex.stackexchange.com/questions/76273/multiple-pdfs-with-page-group-included-in-a-single-page-warning
\pdfsuppresswarningpagegroup=1
% ---------------------------------------------------------------------
% Definitions etc.
% ---------------------------------------------------------------------
\NewDocumentCommand\CiteText{m}{{\tiny\textcolor{gray}{#1}}}